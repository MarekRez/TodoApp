<div class="container my-5">
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                <i class="bi bi-plus-circle me-2"></i>Create New Todo
            </h5>
        </div>
        <div class="card-body p-4">
            <form [formGroup]="todoForm" (ngSubmit)="submitTodo()" class="row g-3">
                <div class="col-md-12">
                    <label for="todoName" class="form-label">Task Name</label>
                    <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-bookmark"></i>
            </span>
                        <input
                                type="text"
                                class="form-control"
                                id="todoName"
                                formControlName="name"
                                placeholder="What needs to be done?"
                        />
                    </div>
                    @if (todoForm.get('name')?.invalid && todoForm.get('name')?.touched) {
                        <small class="text-danger mt-1">
                            <i class="bi bi-exclamation-circle me-1"></i>Task name is required
                        </small>
                    }
                </div>

                <div class="col-md-12">
                    <label for="todoDescription" class="form-label">Description</label>
                    <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-text-paragraph"></i>
            </span>
                        <textarea
                                class="form-control"
                                id="todoDescription"
                                formControlName="description"
                                rows="3"
                                placeholder="Add details about your task..."
                        ></textarea>
                    </div>
                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-primary" [disabled]="todoForm.invalid">
                        <i class="bi" [class.bi-plus-circle]="!isEditMode" [class.bi-save]="isEditMode"></i>
                        {{ isEditMode ? 'Update Task' : 'Add Task' }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <h5 class="card-title mb-0">
                <i class="bi bi-list-task me-2"></i>My Tasks
            </h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th scope="col" width="60">Status</th>
                    <th scope="col">Task</th>
                    <th scope="col">Description</th>
                    <th scope="col" width="120">Actions</th>
                </tr>
                </thead>
                <tbody>
                    @for (todo of todos; track $index) {
                        <tr>
                            <td class="text-center">
                                <div class="form-check">
                                    <input
                                            type="checkbox"
                                            class="form-check-input"
                                            [checked]="todo.completed"
                                            (change)="patchTodoStatus(todo.id!, !todo.completed)"
                                    >
                                </div>
                            </td>
                            <td [class.text-decoration-line-through]="todo.completed">{{ todo.name }}</td>
                            <td [class.text-decoration-line-through]="todo.completed">{{ todo.description }}</td>
                            <td>
                                <div class="btn-group">
                                    <button
                                            class="btn btn-outline-primary btn-sm"
                                            (click)="handleEdit(todo)"
                                            title="Edit"
                                    >
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button
                                            class="btn btn-outline-danger btn-sm"
                                            (click)="deleteTodo(todo.id!)"
                                            title="Delete"
                                    >
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    } @empty {
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">
                                <i class="bi bi-inbox-fill fs-4 d-block mb-2"></i>
                                No tasks found
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="card-footer bg-white">
            <nav aria-label="Page navigation" class="d-flex justify-content-between align-items-center">
                <span class="text-muted small">
                    Showing {{ pageNum * size + 1 }} - {{ Math.min((pageNum + 1) * size, totalTasks) }} of {{ totalTasks }} tasks.
                </span>
                <ul class="pagination pagination-sm mb-0 mx-auto">
                    <li class="page-item">
                        <a class="page-link" (click)="getTodosWithPagination(pageNum-1)" [class.disabled]="pageNum === 0" aria-label="Previous">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>

                    @for (tempPage of generatedPages; track $index) {
                    <li class="page-item">
                        <a class="page-link"
                           [class.active]="pageNum === tempPage.value"
                           (click)="getTodosWithPagination(tempPage.value)">{{ tempPage.displayValue }}
                        </a>
                    </li>
                    }

                    <li class="page-item">
                        <a class="page-link" (click)="getTodosWithPagination(pageNum+1)" [class.disabled]="pageNum === generatedPages.length - 1" aria-label="Next">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <app-toast #toast></app-toast>
</div>
